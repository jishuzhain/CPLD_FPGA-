
module mesure_f(sysclk, fx,  
				clk_25mhz, 
				clk_cnthz, sel0, 
				sel1, sel2, data_out);
input 	sysclk;
input   fx;//å¾…æµ‹é¢‘ç‡è¾“å…¥
input sel0, sel1, sel2;  //å•ç‰‡æœº3ä¸ªé€‰æ‹©ä½
output[7:0] data_out; //æ•°æ®è¾“å‡ºç¼“å†²å¯„å­˜å™¨
reg[7:0] data_out;
output reg clk_25mhz, clk_cnthz; //0.5Hzä½œä¸ºé—¸é—¨å’Œä¸­æ–­ä¿¡å·
reg[29:0] counter3;
reg[31:0]  fxCnt;   //Êä³öËø´æÖµ 
reg[31:0]  fbaseCnt;  //Êä³öËø´æÖµ 
reg   startCnt;   //å¼€å§‹è®¡æ•°æ ‡å¿—ä½
reg[31:0] fxCntTemp, fbaseCntTemp;  //å¾…æµ‹é¢‘ç‡è®¡æ•°å€¼
//---------------------------------------åˆ†é¢‘æ¨¡å—-------------------------------------
//0.5Hzåˆ†é¢‘
always @(posedge sysclk)//or negedge reset
begin
		clk_25mhz <= ~clk_25mhz; 
end

always @(posedge clk_25mhz)
begin
	if(counter3 == 24999999)  //100Hz ä¸º 4
		begin 
		clk_cnthz = ~clk_cnthz;  //0.5Hzè¾“å‡ºä½œä¸ºé—¸é—¨ä¿¡å·
		counter3 = 0;
		end
	else
		begin
		counter3 = counter3 + 1;
		end
end
//--------------------------------------------------------------------------------

//----------------------------------------ç­‰ç²¾åº¦æµ‹é¢‘æ¨¡å—----------------------------------
//ÒÑÖªµÄÆµÂÊ¼ÆÊı
always @ (posedge clk_25mhz)  
begin
  if(startCnt)
    fbaseCntTemp <= fbaseCntTemp + 1;
  else
    fbaseCntTemp <= 32'h00000000;
end

//è¢«æµ‹çš„é¢‘ç‡è®¡æ•°
always @ (posedge fx)   
begin
  if(startCnt)
    fxCntTemp <= fxCntTemp + 1;
  else
    fxCntTemp <= 32'h00000000;
end

//synchronous fgateåŒæ­¥é—¸é—¨
always @ (posedge fx) 
begin
  if(clk_cnthz) 
    startCnt <= 1'b1;
  else
    startCnt <= 1'b0;
end

//outputµçÆ½±ä»¯µÄÊ±ºòÊä³öËø´æ
always @ (negedge startCnt) 
begin
  fxCnt    <= fxCntTemp;
  fbaseCnt <= fbaseCntTemp;
end
//---------------------------------------------------------------------------------

//----------------------------------é€šä¿¡æ¨¡å—---------------------------------------
always @(sel0 or sel1 or sel2 or fxCnt or fbaseCnt)
begin//å›°éš¾ï¼Œç°åœ¨åªè¾“å‡ºä¸€ä¸ªè®¡æ•°å€¼ï¼Œå¤šæƒ³æƒ³
	if(sel0 == 1'b0)
		if(sel1 == 1'b0)
			case(sel2)
			1'b0: data_out[7:0] = fxCnt[7:0]; //æœ€ä½8ä½
			1'b1: data_out[7:0] = fxCnt[15:8];
			default: data_out[7:0] = 8'bx; //è¾“å‡ºæ— å…³å€¼
			endcase
		else
			case(sel2)
			1'b0: data_out[7:0] = fxCnt[23:16]; //8ä½
			1'b1: data_out[7:0] = fxCnt[31:24];
			default: data_out[7:0] = 8'bx; //è¾“å‡ºæ— å…³å€¼
			endcase
	else
		if(sel1 == 1'b0)
			case(sel2)
			1'b0: data_out[7:0] = fbaseCnt[7:0]; //æœ€ä½8ä½
			1'b1: data_out[7:0] = fbaseCnt[15:8];
			default: data_out[7:0] = 8'bx; //è¾“å‡ºæ— å…³å€¼
			endcase
		else
			case(sel2)
			1'b0: data_out[7:0] = fbaseCnt[23:16]; //8ä½
			1'b1: data_out[7:0] = fbaseCnt[31:24];
			default: data_out[7:0] = 8'bx; //è¾“å‡ºæ— å…³å€¼
			endcase
	
end	

//---------------------------------------------------------------------------------------
/*
always @(posedge sysclk)//or negedge reset
begin
		if(counter4 == 24999)
			begin
			counter4 <= 0;
			clk_1khz <= ~clk_1khz;
			end
		else
			begin
			counter4 <= counter4 + 1;
			end 
end

always @(posedge clk_1khz)
begin
	if(counter3 == 999)  //100Hz ä¸º 4
		begin 
		clk_cnthz = ~clk_cnthz;
		counter3 = 0;
		end
	else
		begin
		counter3 = counter3 + 1;
		end
end
*/
endmodule 